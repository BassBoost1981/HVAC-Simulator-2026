<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self';">
    <title>HVAC Simulator</title>
    <link rel="stylesheet" href="style.css">

    <!-- Three.js Import Map (vendored locally for offline use) -->
    <script type="importmap">
    {
        "imports": {
            "three": "./lib/three.module.min.js",
            "three/addons/": "./lib/addons/"
        }
    }
    </script>
</head>
<body>
    <!-- Main Application Layout -->
    <div id="app">

        <!-- Header -->
        <header id="header">
            <span class="app-title" data-i18n="app.title">HVAC Simulator</span>
            <span class="project-name" id="project-name">Neues Projekt</span>
            <div class="header-actions">
                <div class="lang-toggle">
                    <button id="lang-de" class="active" data-lang="de">DE</button>
                    <button id="lang-en" data-lang="en">EN</button>
                </div>
            </div>
        </header>

        <!-- Sidebar: Outlet Library -->
        <aside id="sidebar">
            <div class="sidebar-title" data-i18n="sidebar.title">Bibliothek</div>
            <div id="sidebar-content">
                <!-- Populated by sidebar.js -->
            </div>
        </aside>

        <!-- 3D Viewport -->
        <main id="viewport">
            <canvas id="viewport-canvas"></canvas>
        </main>

        <!-- Properties Panel -->
        <aside id="properties-panel">
            <div class="props-header" data-i18n="props.title">Eigenschaften</div>
            <div id="props-content">
                <!-- Populated by properties.js -->
                <div class="empty-state" id="props-empty">
                    <div class="empty-state-icon">&#9881;</div>
                    <div class="empty-state-text" data-i18n="props.empty">
                        Erstellen Sie einen Raum und platzieren Sie einen Auslass
                    </div>
                </div>
            </div>
        </aside>

        <!-- Toolbar -->
        <div id="toolbar">
            <div class="toolbar-group">
                <button class="toolbar-btn" id="btn-view-perspective" data-i18n="toolbar.perspective">Perspektive</button>
                <button class="toolbar-btn" id="btn-view-top" data-i18n="toolbar.top">Draufsicht</button>
                <button class="toolbar-btn" id="btn-view-front" data-i18n="toolbar.front">Vorne</button>
                <button class="toolbar-btn" id="btn-view-side" data-i18n="toolbar.side">Seite</button>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-group">
                <span class="toolbar-label">Grid:</span>
                <select class="toolbar-select" id="grid-snap-select">
                    <option value="0.1">0.10 m</option>
                    <option value="0.25" selected>0.25 m</option>
                    <option value="0.5">0.50 m</option>
                    <option value="1.0">1.00 m</option>
                </select>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-group">
                <button class="toolbar-btn active" id="btn-vis-cone" data-i18n="toolbar.cone">Kegel</button>
                <button class="toolbar-btn" id="btn-vis-particles" data-i18n="toolbar.particles">Partikel</button>
                <button class="toolbar-btn" id="btn-vis-zones" data-i18n="toolbar.zones">Zonen</button>
                <button class="toolbar-btn" id="btn-vis-sound" data-i18n="toolbar.sound">Schall</button>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-group">
                <span class="toolbar-label" data-i18n="toolbar.height">Höhe:</span>
                <input type="range" id="slice-height-slider" min="0.1" max="3.0" step="0.1" value="1.2" class="toolbar-slider" title="Schnittebene für Heatmaps">
                <span class="toolbar-value" id="slice-height-value">1.2 m</span>
            </div>
        </div>

        <!-- Status Bar -->
        <div id="status-bar">
            <span class="status-item" id="status-outlets">0 Auslässe</span>
            <span class="status-item status-balance" id="status-balance"></span>
            <span class="status-item" id="status-calc">Berechnung: —</span>
            <span class="status-spacer"></span>
            <div class="status-actions">
                <button class="status-btn" id="btn-undo" title="Ctrl+Z" disabled>&#8630;</button>
                <button class="status-btn" id="btn-redo" title="Ctrl+Shift+Z" disabled>&#8631;</button>
                <div class="obstacle-btn-wrapper">
                    <button class="status-btn" id="btn-add-obstacle" data-i18n="obstacle.add">Hindernis</button>
                    <div class="obstacle-menu" id="obstacle-menu"></div>
                </div>
                <button class="status-btn" id="btn-new-room" data-i18n="status.newRoom">Neuer Raum</button>
                <button class="status-btn" id="btn-load" data-i18n="status.load">Laden</button>
                <button class="status-btn" id="btn-save" data-i18n="status.save">Speichern</button>
                <button class="status-btn" id="btn-pdf" data-i18n="status.pdf">PDF</button>
            </div>
        </div>
    </div>

    <!-- Room Creation Modal -->
    <div class="modal-overlay" id="room-modal-overlay">
        <div class="modal" id="room-modal">
            <div class="modal-title" data-i18n="room.create">Neuen Raum erstellen</div>
            <div class="modal-subtitle" data-i18n="room.create.subtitle">Geben Sie die Raummaße in Metern ein</div>

            <div class="modal-dimensions">
                <div class="form-group" id="fg-length">
                    <label for="room-length" data-i18n="room.length">Länge (L)</label>
                    <div class="input-row">
                        <input type="number" id="room-length" min="0.5" max="50" step="0.1" value="8">
                        <span class="input-unit">m</span>
                    </div>
                    <div class="form-error">0.5 – 50 m</div>
                </div>
                <div class="form-group" id="fg-width">
                    <label for="room-width" data-i18n="room.width">Breite (B)</label>
                    <div class="input-row">
                        <input type="number" id="room-width" min="0.5" max="50" step="0.1" value="6">
                        <span class="input-unit">m</span>
                    </div>
                    <div class="form-error">0.5 – 50 m</div>
                </div>
                <div class="form-group" id="fg-height">
                    <label for="room-height" data-i18n="room.height">Höhe (H)</label>
                    <div class="input-row">
                        <input type="number" id="room-height" min="0.5" max="20" step="0.1" value="3">
                        <span class="input-unit">m</span>
                    </div>
                    <div class="form-error">0.5 – 20 m</div>
                </div>
            </div>

            <div class="form-group">
                <label for="room-type" data-i18n="room.type">Raumtyp</label>
                <select id="room-type">
                    <option value="office">Einzelbüro (35 dB(A))</option>
                    <option value="open_office">Großraumbüro (40 dB(A))</option>
                    <option value="meeting_room" selected>Besprechungsraum (30–35 dB(A))</option>
                    <option value="classroom">Klassenzimmer (35 dB(A))</option>
                    <option value="hospital">Krankenhauszimmer (30 dB(A))</option>
                    <option value="restaurant">Restaurant (45 dB(A))</option>
                    <option value="auditorium">Hörsaal (30 dB(A))</option>
                </select>
            </div>

            <div class="form-group">
                <label for="room-temp" data-i18n="room.temperature">Raumtemperatur</label>
                <div class="input-row">
                    <input type="number" id="room-temp" min="18" max="30" step="0.5" value="22">
                    <span class="input-unit">°C</span>
                </div>
            </div>

            <div class="modal-subtitle" style="margin-top:12px;" data-i18n="surface.title">Oberflächenmaterialien</div>
            <div class="modal-surfaces">
                <div class="form-group form-group-sm">
                    <label for="surface-ceiling" data-i18n="surface.ceiling">Decke</label>
                    <select id="surface-ceiling">
                        <option value="acoustic_tile" selected>Akustikdecke (α 0.85)</option>
                        <option value="concrete">Beton/Putz (α 0.03)</option>
                        <option value="plasterboard">Gipskarton (α 0.08)</option>
                    </select>
                </div>
                <div class="form-group form-group-sm">
                    <label for="surface-floor" data-i18n="surface.floor">Boden</label>
                    <select id="surface-floor">
                        <option value="carpet" selected>Teppichboden (α 0.30)</option>
                        <option value="concrete">Beton/Putz (α 0.03)</option>
                        <option value="glass">Fliesen/Vinyl (α 0.12)</option>
                    </select>
                </div>
                <div class="form-group form-group-sm">
                    <label for="surface-walls" data-i18n="surface.walls">Wände</label>
                    <select id="surface-walls">
                        <option value="concrete" selected>Beton/Putz (α 0.03)</option>
                        <option value="plasterboard">Gipskarton (α 0.08)</option>
                        <option value="glass">Fenster/Glas (α 0.12)</option>
                        <option value="acoustic_tile">Akustikpaneel (α 0.85)</option>
                    </select>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn-secondary" id="room-modal-cancel" style="display:none;" data-i18n="room.cancel">Abbrechen</button>
                <button class="btn-primary" id="room-modal-create" data-i18n="room.create.button">Erstellen</button>
            </div>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div class="modal-overlay" id="welcome-modal-overlay">
        <div class="modal">
            <div class="modal-title" data-i18n="welcome.title">HVAC Simulator</div>
            <div class="modal-subtitle" data-i18n="welcome.subtitle">Luftauslass-Planung & Akustik-Simulation</div>
            <div class="welcome-options">
                <div class="welcome-option" id="welcome-new">
                    <div class="option-title" data-i18n="welcome.new">Neues Projekt</div>
                    <div class="option-desc" data-i18n="welcome.new.desc">Raum erstellen und Auslässe platzieren</div>
                </div>
                <div class="welcome-option" id="welcome-example">
                    <div class="option-title" data-i18n="welcome.example">Beispiel laden</div>
                    <div class="option-desc" data-i18n="welcome.example.desc">Besprechungsraum 8×6×3 m mit 2 Drallauslässen</div>
                </div>
                <div class="welcome-option" id="welcome-open">
                    <div class="option-title" data-i18n="welcome.open">Projekt öffnen</div>
                    <div class="option-desc" data-i18n="welcome.open.desc">.hvac-Datei vom Computer laden</div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Libraries (UMD, loaded as globals) -->
    <script src="lib/jspdf.umd.min.js"></script>
    <script src="lib/html2canvas.min.js"></script>

    <!-- App Entry Point -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
